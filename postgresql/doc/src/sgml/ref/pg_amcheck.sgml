<!--
doc/src/sgml/ref/pg_amcheck.sgml
PostgreSQL documentation
-->

<refentry id="app-pgamcheck">
<!--==========================orignal english content==========================
 <indexterm zone="app-pgamcheck">
  <primary>pg_amcheck</primary>
 </indexterm>
____________________________________________________________________________-->
 <indexterm zone="app-pgamcheck">
  <primary>pg_amcheck</primary>
 </indexterm>

<!--==========================orignal english content==========================
 <refmeta>
  <refentrytitle><application>pg_amcheck</application></refentrytitle>
  <manvolnum>1</manvolnum>
  <refmiscinfo>Application</refmiscinfo>
 </refmeta>
____________________________________________________________________________-->
 <refmeta>
  <refentrytitle><application>pg_amcheck</application></refentrytitle>
  <manvolnum>1</manvolnum>
  <refmiscinfo>Application</refmiscinfo>
 </refmeta>

<!--==========================orignal english content==========================
 <refnamediv>
  <refname>pg_amcheck</refname>
  <refpurpose>checks for corruption in one or more
  <productname>PostgreSQL</productname> databases</refpurpose>
 </refnamediv>
____________________________________________________________________________-->
 <refnamediv>
  <refname>pg_amcheck</refname>
  <refpurpose>在一个或多个<productname>PostgreSQL</productname>数据库中检查损坏</refpurpose>
 </refnamediv>

 <refsynopsisdiv>
<!--==========================orignal english content==========================
  <cmdsynopsis>
   <command>pg_amcheck</command>
   <arg rep="repeat"><replaceable>option</replaceable></arg>
   <arg><replaceable>dbname</replaceable></arg>
  </cmdsynopsis>
____________________________________________________________________________-->
  <cmdsynopsis>
   <command>pg_amcheck</command>
   <arg rep="repeat"><replaceable>option</replaceable></arg>
   <arg><replaceable>dbname</replaceable></arg>
  </cmdsynopsis>
 </refsynopsisdiv>

 <refsect1>
<!--==========================orignal english content==========================
  <title>Description</title>
____________________________________________________________________________-->
  <title>Description</title>

<!--==========================orignal english content==========================
  <para>
   <application>pg_amcheck</application> supports running
   <xref linkend="amcheck"/>'s corruption checking functions against one or
   more databases, with options to select which schemas, tables and indexes to
   check, which kinds of checking to perform, and whether to perform the checks
   in parallel, and if so, the number of parallel connections to establish and
   use.
  </para>
____________________________________________________________________________-->
  <para>
   <application>pg_amcheck</application>支持对一个或多个数据库运行<xref linkend="amcheck"/>的损坏检查函数，并提供选项来选择要检查的模式、表和索引、要执行的检查类型以及是否并行执行检查，如果是，按并行数建立连接并使用。
  </para>

<!--==========================orignal english content==========================
  <para>
   Only table relations and btree indexes are currently supported.  Other
   relation types are silently skipped.
  </para>
____________________________________________________________________________-->
  <para>
   当前仅支持表关系和btree索引。其他关系类型将自动跳过。
  </para>

<!--==========================orignal english content==========================
  <para>
   If <literal>dbname</literal> is specified, it should be the name of a
   single database to check, and no other database selection options should
   be present. Otherwise, if any database selection options are present,
   all matching databases will be checked. If no such options are present,
   the default database will be checked. Database selection options include
   <option>-&minus;all</option>, <option>-&minus;database</option> and
   <option>-&minus;exclude-database</option>. They also include
   <option>-&minus;relation</option>, <option>-&minus;exclude-relation</option>,
   <option>-&minus;table</option>, <option>-&minus;exclude-table</option>,
   <option>-&minus;index</option>, and <option>-&minus;exclude-index</option>,
   but only when such options are used with a three-part pattern
   (e.g. <option>mydb*.myschema*.myrel*</option>).  Finally, they include
   <option>-&minus;schema</option> and <option>-&minus;exclude-schema</option>
   when such options are used with a two-part pattern
   (e.g. <option>mydb*.myschema*</option>).
  </para>
____________________________________________________________________________-->
  <para>
   如果指定了<literal>dbname</literal>，则它应该是要检查的单个数据库的名称，并且不应该存在其他数据库选择选项。否则，如果存在任何数据库选择选项，将检查所有匹配的数据库。如果不存在此类选项，将选中默认数据库。数据库选择选项包括<option>--all</option>，<option>--database</option>和<option>--exclude-database</option>。它们还包括<option>--relation</option>，<option>--exclude-relation</option>，
   <option>--table</option>，<option>--exclude-table</option>，<option>--index</option>，和<option>--exclude-index</option>，但仅当这些选项与三段式模式一起使用时（例如，<option>mydb*.myschema*.myrel*</option>）。最后，它们包括<option>--schema</option>和<option>--exclude-schema</option>
当这些选项与两段式模式一起使用时（例如<option>mydb*.myschema*</option>）。
  </para>

<!--==========================orignal english content==========================
  <para>
   <replaceable>dbname</replaceable> can also be a
   <link linkend="libpq-connstring">connection string</link>.
  </para>
____________________________________________________________________________-->
  <para>
   <replaceable>dbname</replaceable>也可以是一个<link linkend="libpq-connstring">连接字符串</link>.
  </para>
 </refsect1>

 <refsect1>
<!--==========================orignal english content==========================
  <title>Options</title>
____________________________________________________________________________-->
  <title>选项</title>

<!--==========================orignal english content==========================
  <para>
   The following command-line options control what is checked:

   <variablelist>
    <varlistentry>
     <term><option>-a</option></term>
     <term><option>-&minus;all</option></term>
       <listitem>
      <para>
       Check all databases, except for any excluded via
       <option>-&minus;exclude-database</option>.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-d <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>-&minus;database=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       Check databases matching the specified
       <link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>,
       except for any excluded by <option>-&minus;exclude-database</option>.
       This option can be specified more than once.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-D <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>-&minus;exclude-database=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       Exclude databases matching the given
       <link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>.
       This option can be specified more than once.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-i <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>-&minus;index=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       Check indexes matching the specified
       <link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>,
       unless they are otherwise excluded.
       This option can be specified more than once.
      </para>
      <para>
       This is similar to the <option>-&minus;relation</option> option, except that
       it applies only to indexes, not tables.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-I <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>-&minus;exclude-index=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       Exclude indexes matching the specified
       <link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>.
       This option can be specified more than once.
      </para>
      <para>
       This is similar to the <option>-&minus;exclude-relation</option> option,
       except that it applies only to indexes, not tables.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-r <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>-&minus;relation=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       Check relations matching the specified
       <link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>,
       unless they are otherwise excluded.
       This option can be specified more than once.
      </para>
      <para>
       Patterns may be unqualified, e.g. <literal>myrel*</literal>, or they
       may be schema-qualified, e.g. <literal>myschema*.myrel*</literal> or
       database-qualified and schema-qualified, e.g.
       <literal>mydb*.myscheam*.myrel*</literal>. A database-qualified
       pattern will add matching databases to the list of databases to be
       checked.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-R <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>-&minus;exclude-relation=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       Exclude relations matching the specified
       <link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>.
       This option can be specified more than once.
      </para>
      <para>
       As with <option>-&minus;relation</option>, the
       <link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link> may be unqualified, schema-qualified,
       or database- and schema-qualified.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-s <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>-&minus;schema=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       Check tables and indexes in schemas matching the specified
       <link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>, unless they are otherwise excluded.
       This option can be specified more than once.
      </para>
      <para>
       To select only tables in schemas matching a particular pattern,
       consider using something like
       <literal>-&minus;table=SCHEMAPAT.* -&minus;no-dependent-indexes</literal>.
       To select only indexes, consider using something like
       <literal>-&minus;index=SCHEMAPAT.*</literal>.
      </para>
      <para>
       A schema pattern may be database-qualified. For example, you may
       write <literal>-&minus;schema=mydb*.myschema*</literal> to select
       schemas matching <literal>myschema*</literal> in databases matching
       <literal>mydb*</literal>.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-S <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>-&minus;exclude-schema=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       Exclude tables and indexes in schemas matching the specified
       <link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>.
       This option can be specified more than once.
      </para>
      <para>
       As with <option>-&minus;schema</option>, the pattern may be
       database-qualified.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-t <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>-&minus;table=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       Check tables matching the specified
       <link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>,
       unless they are otherwise excluded.
       This option can be specified more than once.
      </para>
      <para>
       This is similar to the <option>-&minus;relation</option> option, except that
       it applies only to tables, not indexes.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-T <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>-&minus;exclude-table=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       Exclude tables matching the specified
       <link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>.
       This option can be specified more than once.
      </para>
      <para>
       This is similar to the <option>-&minus;exclude-relation</option> option,
       except that it applies only to tables, not indexes.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-&minus;no-dependent-indexes</option></term>
     <listitem>
      <para>
       By default, if a table is checked, any btree indexes of that table
       will also be checked, even if they are not explicitly selected by
       an option such as <literal>-&minus;index</literal> or
       <literal>-&minus;relation</literal>. This option suppresses that behavior.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-&minus;no-dependent-toast</option></term>
     <listitem>
      <para>
       By default, if a table is checked, its toast table, if any, will also
       be checked, even if it is not explicitly selected by an option
       such as <literal>-&minus;table</literal> or <literal>-&minus;relation</literal>.
       This option suppresses that behavior.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-&minus;no-strict-names</option></term>
     <listitem>
      <para>
       By default, if an argument to <literal>-&minus;database</literal>,
       <literal>-&minus;table</literal>, <literal>-&minus;index</literal>,
       or <literal>-&minus;relation</literal> matches no objects, it is a fatal
       error. This option downgrades that error to a warning.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </para>
____________________________________________________________________________-->
  <para>
   以下命令行选项控制要检查的内容：

   <variablelist>
    <varlistentry>
     <term><option>-a</option></term>
     <term><option>--all</option></term>
       <listitem>
      <para>
       检查所有数据库，但通过<option>--exclude-database</option>排除的数据库除外。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-d <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>--database=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       检查与指定的<link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>匹配的数据库，但<option>--exclude-database</option>排除的数据库除外。可以多次指定此选项。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-D <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>--exclude-database=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       排除与给定的<link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>匹配的数据库。可以多次指定此选项。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-i <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>--index=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       检查与指定的<link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>匹配的索引，除非它们被排除在外。可以多次指定此选项。
      </para>
      <para>
       这类似于<option>--relation</option>选项，只是它只适用于索引，而不适用于表。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-I <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>--exclude-index=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       排除与指定的<link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>匹配的索引。可以多次指定此选项。
      </para>
      <para>
       这类似于<option>--exclude-relation</option>选项，只是它只适用于索引，而不适用于表。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-r <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>--relation=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       检查与指定的<link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>匹配的关系，除非它们被排除在外。可以多次指定此选项。
      </para>
      <para>
       模式可能是非限定的，例如<literal>myrel*</literal>，或者它们可能是模式限定的，如<literal>myschema*.myrel*</literal>或数据库限定和模式限定，例如<literal>mydb*.myscheam*.myrel*</literal>。数据库限定模式将向要检查的数据库列表中添加匹配的数据库。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-R <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>--exclude-relation=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       排除与指定的<link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>匹配的关系。可以多次指定此选项。
      </para>
      <para>
       As with <option>--relation</option>, the
       <link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link> may be unqualified, schema-qualified,
       or database- and schema-qualified.
       与<option>--relation</option>一样，<link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>可以是非限定的、模式限定的或数据库和模式限定的。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-s <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>--schema=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       检查模式中与指定的<link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>匹配的表和索引，除非另有排除。可以多次指定此选项。
      </para>
      <para>
       要仅选择与特定模式匹配的模式中的表，请考虑使用类似<literal>--table=SCHEMAPAT.* --no-dependent-indexes</literal>。要仅选择索引，请考虑使用类似<literal>--index=SCHEMAPAT.*</literal>的方法。
      </para>
      <para>
       模式模式可以是数据库限定的。例如，你可以编写<literal>--schema=mydb*.myschema*</literal>在数据库中选择匹配 <literal>mydb*</literal>的模式。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-S <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>--exclude-schema=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       排除模式中与指定的<link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>匹配的表和索引。可以多次指定此选项。
      </para>
      <para>
       与<option>--schema</option>一样，模式可以是数据库限定的。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-t <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>--table=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       检查与指定的<link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>匹配的表，除非它们被排除在外。可以多次指定此选项。
      </para>
      <para>
       这类似于<option>--relation</option>选项，只是它只适用于表，而不适用于索引。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-T <replaceable class="parameter">pattern</replaceable></option></term>
     <term><option>--exclude-table=<replaceable class="parameter">pattern</replaceable></option></term>
     <listitem>
      <para>
       排除与指定的<link linkend="app-psql-patterns"><replaceable class="parameter">pattern</replaceable></link>匹配的表。可以多次指定此选项。
      </para>
      <para>
       这类似于<option>--exclude-relation</option>选项，只是它只适用于表，而不适用于索引。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-dependent-indexes</option></term>
     <listitem>
      <para>
       默认情况下，如果选中了一个表，则该表的任何btree索引也将被选中，即使它们没有被诸如<literal>--index</literal>或<literal>--relation</literal>之类的选项显式选择。此选项将抑制该行为。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-dependent-toast</option></term>
     <listitem>
      <para>
       默认情况下，如果选中了一个表，则也将检查它的toast表（如果有），即使它没有通过诸如<literal>--table</literal>或<literal>--relation</literal>之类的选项显式选择。此选项将抑制该行为。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-strict-names</option></term>
     <listitem>
      <para>
       默认情况下，如果<literal>--database</literal>，<literal>--table</literal>，<literal>--index</literal>，或<literal>--relation</literal>的参数不匹配任何对象，则这是一个致命错误。此选项将该错误降级为警告。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </para>

<!--==========================orignal english content==========================
  <para>
   The following command-line options control checking of tables:

   <variablelist>
    <varlistentry>
     <term><option>-&minus;exclude-toast-pointers</option></term>
     <listitem>
      <para>
       By default, whenever a toast pointer is encountered in a table,
       a lookup is performed to ensure that it references apparently-valid
       entries in the toast table. These checks can be quite slow, and this
       option can be used to skip them.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-&minus;on-error-stop</option></term>
     <listitem>
      <para>
       After reporting all corruptions on the first page of a table where
       corruption is found, stop processing that table relation and move on
       to the next table or index.
      </para>
      <para>
       Note that index checking always stops after the first corrupt page.
       This option only has meaning relative to table relations.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-&minus;skip=<replaceable class="parameter">option</replaceable></option></term>
     <listitem>
      <para>
       If <literal>all-frozen</literal> is given, table corruption checks
       will skip over pages in all tables that are marked as all frozen.
      </para>
      <para>
       If <literal>all-visible</literal> is given, table corruption checks
       will skip over pages in all tables that are marked as all visible.
      </para>
      <para>
       By default, no pages are skipped.  This can be specified as
       <literal>none</literal>, but since this is the default, it need not be
       mentioned.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-&minus;startblock=<replaceable class="parameter">block</replaceable></option></term>
     <listitem>
      <para>
       Start checking at the specified block number. An error will occur if
       the table relation being checked has fewer than this number of blocks.
       This option does not apply to indexes, and is probably only useful
       when checking a single table relation. See <literal>-&minus;endblock</literal>
       for further caveats.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-&minus;endblock=<replaceable class="parameter">block</replaceable></option></term>
     <listitem>
      <para>
       End checking at the specified block number.  An error will occur if the
       table relation being checked has fewer than this number of blocks.
       This option does not apply to indexes, and is probably only useful when
       checking a single table relation. If both a regular table and a toast
       table are checked, this option will apply to both, but higher-numbered
       toast blocks may still be accessed while validating toast pointers,
       unless that is suppressed using
       <option>-&minus;exclude-toast-pointers</option>.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </para>
____________________________________________________________________________-->
  <para>
   以下命令行选项用于控制表的检查：

   <variablelist>
    <varlistentry>
     <term><option>--exclude-toast-pointers</option></term>
     <listitem>
      <para>
       默认情况下，每当在表中遇到toast指针时，都会执行查找以确保它引用toast表中明显有效的条目。这些检查可能非常慢，可以使用此选项跳过这些检查。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--on-error-stop</option></term>
     <listitem>
      <para>
       在发现损坏的表的第一页上报告所有损坏后，停止处理该表关系，并转到下一个表或索引。
      </para>
      <para>
       请注意，索引检查总是在第一个损坏页之后停止。此选项仅与表关系相关。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--skip=<replaceable class="parameter">option</replaceable></option></term>
     <listitem>
      <para>
       如果给定<literal>all-frozen</literal>，表损坏检查将跳过所有表中标记为全部冻结的页面。
      </para>
      <para>
       如果给定了<literal>all-visible</literal>，则表损坏检查将跳过所有表中标记为所有可见的页面。
      </para>
      <para>
       默认情况下，不跳过任何页面。这可以指定为<literal>none</literal>，但由于这是默认值，因此无需提及。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--startblock=<replaceable class="parameter">block</replaceable></option></term>
     <listitem>
      <para>
       从指定的块号开始检查。如果正在检查的表关系的块数少于此数，则会发生错误。此选项不适用于索引，可能仅在检查单个表关系时有用。请参阅<literal>--endblock</literal>了解更多注意事项。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--endblock=<replaceable class="parameter">block</replaceable></option></term>
     <listitem>
      <para>
       在指定的块号结束检查。如果正在检查的表关系的块数少于此数，则会发生错误。此选项不适用于索引，可能仅在检查单个表关系时有用。如果同时选中常规表和toast表，则此选项将同时适用于这两个表，但在验证toast指针时，仍然可以访问编号更高的toast块，除非使用<option>--exclude-toast-pointers</option>抑制。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </para>

<!--==========================orignal english content==========================
  <para>
   The following command-line options control checking of B-tree indexes:

   <variablelist>
    <varlistentry>
     <term><option>-&minus;heapallindexed</option></term>
     <listitem>
      <para>
       For each index checked, verify the presence of all heap tuples as index
       tuples in the index using <xref linkend="amcheck"/>'s
       <option>heapallindexed</option> option.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-&minus;parent-check</option></term>
     <listitem>
      <para>
       For each btree index checked, use <xref linkend="amcheck"/>'s
       <function>bt_index_parent_check</function> function, which performs
       additional checks of parent/child relationships during index checking.
      </para>
      <para>
       The default is to use <application>amcheck</application>'s
       <function>bt_index_check</function> function, but note that use of the
       <option>-&minus;rootdescend</option> option implicitly selects
       <function>bt_index_parent_check</function>.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-&minus;rootdescend</option></term>
     <listitem>
      <para>
       For each index checked, re-find tuples on the leaf level by performing a
       new search from the root page for each tuple using
       <xref linkend="amcheck"/>'s <option>rootdescend</option> option.
      </para>
      <para>
       Use of this option implicitly also selects the
       <option>-&minus;parent-check</option> option.
      </para>
      <para>
       This form of verification was originally written to help in the
       development of btree index features.  It may be of limited use or even
       of no use in helping detect the kinds of corruption that occur in
       practice.  It may also cause corruption checking to take considerably
       longer and consume considerably more resources on the server.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </para>
____________________________________________________________________________-->
  <para>
   以下命令行选项用来控制B树索引的检查：

   <variablelist>
    <varlistentry>
     <term><option>--heapallindexed</option></term>
     <listitem>
      <para>
       对于每个选中的索引，使用<xref linkend="amcheck"/>'s
       <option>heapallindexed</option>选项验证索引中是否存在作为索引元组的所有堆元组。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--parent-check</option></term>
     <listitem>
      <para>
       对于检查的每个btree索引，使用<xref linkend="amcheck"/>的<function>bt_index_parent_check</function>函数，该函数在索引检查期间对父/子关系执行其他检查。
      </para>
      <para>
       默认情况是使用<application>amcheck</application>的<function>bt_index_check</function>函数，但请注意，使用<option>--rootdescend</option>选项会隐式选择<function>bt_index_parent_check</function>。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--rootdescend</option></term>
     <listitem>
      <para>
       对于每个选中的索引，通过使用<xref linkend="amcheck"/>'s <option>rootdescend</option>选项从根页面对每个元组执行新搜索，在叶级重新查找元组。
      </para>
      <para>
       使用此选项也会隐式选择<option>--parent-check</option>选项。
      </para>
      <para>
       这种形式的验证最初是为了帮助开发btree索引功能而编写的。它在帮助检测实践中发生的损坏类型方面可能用处有限，甚至毫无用处。它还可能导致损坏检查花费相当长的时间，并消耗服务器上相当多的资源。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </para>

  <warning>
<!--==========================orignal english content==========================
   <para>
    The extra checks performed against B-tree indexes when the
    <option>-&minus;parent-check</option> option or the
    <option>-&minus;rootdescend</option> option is specified require
    relatively strong relation-level locks.  These checks are the only
    checks that will block concurrent data modification from
    <command>INSERT</command>, <command>UPDATE</command>, and
    <command>DELETE</command> commands.
   </para>
____________________________________________________________________________-->
   <para>
    当指定<option>--parent-check</option>选项或<option>--rootdescend</option>选项时，对B树索引执行的额外检查需要相对强的关系级锁。这些检查是唯一会阻止<command>INSERT</command>，<command>UPDATE</command>，和<command>DELETE</command>命令并发数据修改的检查。
   </para>
  </warning>

<!--==========================orignal english content==========================
  <para>
   The following command-line options control the connection to the server:

   <variablelist>
    <varlistentry>
     <term><option>-h <replaceable class="parameter">hostname</replaceable></option></term>
     <term><option>-&minus;host=<replaceable class="parameter">hostname</replaceable></option></term>
     <listitem>
      <para>
       Specifies the host name of the machine on which the server is running.
       If the value begins with a slash, it is used as the directory for the
       Unix domain socket.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-p <replaceable class="parameter">port</replaceable></option></term>
     <term><option>-&minus;port=<replaceable class="parameter">port</replaceable></option></term>
     <listitem>
      <para>
       Specifies the TCP port or local Unix domain socket file extension on
       which the server is listening for connections.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-U</option></term>
     <term><option>-&minus;username=<replaceable class="parameter">username</replaceable></option></term>
     <listitem>
      <para>
       User name to connect as.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-w</option></term>
     <term><option>-&minus;no-password</option></term>
     <listitem>
      <para>
       Never issue a password prompt.  If the server requires password
       authentication and a password is not available by other means such as
       a <filename>.pgpass</filename> file, the connection attempt will fail.
       This option can be useful in batch jobs and scripts where no user is
       present to enter a password.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-W</option></term>
     <term><option>-&minus;password</option></term>
     <listitem>
      <para>
       Force <application>pg_amcheck</application> to prompt for a password
       before connecting to a database.
      </para>
      <para>
       This option is never essential, since
       <application>pg_amcheck</application> will automatically prompt for a
       password if the server demands password authentication.  However,
       <application>pg_amcheck</application> will waste a connection attempt
       finding out that the server wants a password.  In some cases it is
       worth typing <option>-W</option> to avoid the extra connection attempt.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-&minus;maintenance-db=<replaceable class="parameter">dbname</replaceable></option></term>
     <listitem>
      <para>
       Specifies a database or
       <link linkend="libpq-connstring">connection string</link> to be
       used to discover the list of databases to be checked. If neither
       <option>-&minus;all</option> nor any option including a database pattern is
       used, no such connection is required and this option does nothing.
       Otherwise, any connection string parameters other than
       the database name which are included in the value for this option
       will also be used when connecting to the databases
       being checked. If this option is omitted, the default is
       <literal>postgres</literal> or, if that fails,
       <literal>template1</literal>.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </para>
____________________________________________________________________________-->
  <para>
   以下命令行选项用来控制与服务器的连接：

   <variablelist>
    <varlistentry>
     <term><option>-h <replaceable class="parameter">hostname</replaceable></option></term>
     <term><option>--host=<replaceable class="parameter">hostname</replaceable></option></term>
     <listitem>
      <para>
       指定运行服务器的计算机的主机名。如果该值以斜杠开头，它将用作Unix域套接字的目录。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-p <replaceable class="parameter">port</replaceable></option></term>
     <term><option>--port=<replaceable class="parameter">port</replaceable></option></term>
     <listitem>
      <para>
       指定服务器正在侦听连接的TCP端口或本地Unix域套接字文件扩展名。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-U</option></term>
     <term><option>--username=<replaceable class="parameter">username</replaceable></option></term>
     <listitem>
      <para>
       连接的用户名。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-w</option></term>
     <term><option>--no-password</option></term>
     <listitem>
      <para>
       永远不要发出密码提示。如果服务器需要密码身份验证，并且密码无法通过其他方式（如<filename>.pgpass</filename>文件，连接尝试将失败。在没有用户输入密码的批处理作业和脚本中，此选项非常有用。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-W</option></term>
     <term><option>--password</option></term>
     <listitem>
      <para>
       在连接到数据库之前，强制<application>pg_amcheck</application>提示输入密码。
      </para>
      <para>
       此选项从来都不是必需的，因为如果服务器要求密码身份验证，<application>pg_amcheck</application>将自动提示输入密码。但是，<application>pg_amcheck</application>将浪费一次连接尝试，以发现服务器需要密码。在某些情况下，键入<option>-W</option>以避免额外的连接尝试是值得的。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--maintenance-db=<replaceable class="parameter">dbname</replaceable></option></term>
     <listitem>
      <para>
       指定用于发现要检查的数据库列表的数据库或<link linkend="libpq-connstring">连接字符串</link>。如果既不使用<option>--all</option>也不使用任何包含数据库模式的选项，则不需要这种连接，并且该选项不起任何作用。否则，连接到正在检查的数据库时，也将使用此选项值中包含的数据库名称以外的任何连接字符串参数。如果省略此选项，则默认值为<literal>postgres</literal>，或如果失败，则为<literal>template1</literal>。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </para>

<!--==========================orignal english content==========================
  <para>
   Other options are also available:

   <variablelist>
    <varlistentry>
     <term><option>-e</option></term>
     <term><option>-&minus;echo</option></term>
     <listitem>
      <para>
      Echo to stdout all SQL sent to the server.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-j <replaceable class="parameter">num</replaceable></option></term>
     <term><option>-&minus;jobs=<replaceable class="parameter">num</replaceable></option></term>
     <listitem>
      <para>
       Use <replaceable>num</replaceable> concurrent connections to the server,
       or one per object to be checked, whichever is less.
      </para>
      <para>
       The default is to use a single connection.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-P</option></term>
     <term><option>-&minus;progress</option></term>
     <listitem>
      <para>
       Show progress information. Progress information includes the number
       of relations for which checking has been completed, and the total
       size of those relations. It also includes the total number of relations
       that will eventually be checked, and the estimated size of those
       relations.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-v</option></term>
     <term><option>-&minus;verbose</option></term>
     <listitem>
      <para>
       Print more messages. In particular, this will print a message for
       each relation being checked, and will increase the level of detail
       shown for server errors.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-V</option></term>
     <term><option>-&minus;version</option></term>
     <listitem>
      <para>
       Print the <application>pg_amcheck</application> version and exit.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-&minus;install-missing</option></term>
     <term><option>-&minus;install-missing=<replaceable class="parameter">schema</replaceable></option></term>
     <listitem>
      <para>
       Install any missing extensions that are required to check the
       database(s).  If not yet installed, each extension's objects will be
       installed into the given
       <replaceable class="parameter">schema</replaceable>, or if not specified
       into schema <literal>pg_catalog</literal>.
      </para>
      <para>
       At present, the only required extension is <xref linkend="amcheck"/>.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-?</option></term>
     <term><option>-&minus;help</option></term>
     <listitem>
      <para>
       Show help about <application>pg_amcheck</application> command line
       arguments, and exit.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </para>
____________________________________________________________________________-->
  <para>
   其它允许的选项：

   <variablelist>
    <varlistentry>
     <term><option>-e</option></term>
     <term><option>--echo</option></term>
     <listitem>
      <para>
      回显发送到服务器的所有SQL。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-j <replaceable class="parameter">num</replaceable></option></term>
     <term><option>--jobs=<replaceable class="parameter">num</replaceable></option></term>
     <listitem>
      <para>
       使用<replaceable>num</replaceable>个到服务器的并发连接，或每个要检查的对象使用一个连接，以较小者为准。
      </para>
      <para>
       默认情况是使用单个连接。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-P</option></term>
     <term><option>--progress</option></term>
     <listitem>
      <para>
       显示进度信息。进度信息包括已完成检查的关系数以及这些关系的总大小。它还包括最终要检查的关系的总数，以及这些关系的估计大小。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-v</option></term>
     <term><option>--verbose</option></term>
     <listitem>
      <para>
       打印更多消息。特别是，这将为每个正在检查的关系打印一条消息，并将增加服务器错误的详细程度。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-V</option></term>
     <term><option>--version</option></term>
     <listitem>
      <para>
       打印<application>pg_amcheck</application>版本并退出。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--install-missing</option></term>
     <term><option>--install-missing=<replaceable class="parameter">schema</replaceable></option></term>
     <listitem>
      <para>
       安装检查数据库所需的任何缺少的扩展。如果尚未安装，每个扩展的对象将安装到给定的<replaceable class="parameter">schema</replaceable>中，或者如果未指定则安装到<literal>pg_catalog</literal>模式中。
      </para>
      <para>
       目前，唯一需要的扩展是<xref linkend="amcheck"/>。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-?</option></term>
     <term><option>--help</option></term>
     <listitem>
      <para>
       显示有关<application>pg_amcheck</application>命令行参数的帮助，然后退出。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </para>
 </refsect1>

 <refsect1>
<!--==========================orignal english content==========================
  <title>Notes</title>
____________________________________________________________________________-->
  <title>Notes</title>

<!--==========================orignal english content==========================
  <para>
   <application>pg_amcheck</application> is designed to work with
   <productname>PostgreSQL</productname> 14.0 and later.
  </para>
____________________________________________________________________________-->
  <para>
   <application>pg_amcheck</application>被设计运行于
   <productname>PostgreSQL</productname> 14.0及以上版本。
  </para>
 </refsect1>

 <refsect1>
<!--==========================orignal english content==========================
  <title>See Also</title>
____________________________________________________________________________-->
  <title>See Also</title>

  <simplelist type="inline">
   <member><xref linkend="amcheck"/></member>
  </simplelist>
 </refsect1>
</refentry>
